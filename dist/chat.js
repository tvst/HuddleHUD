(()=>{let e,n,t=document.querySelector("#HuddleHud > ul");function o(){e.style.display=""}function s(){e.style.display="none"}function d(){0==t.children.length&&s()}const c=["#ff4444","#44ff44","#4444ff","#ffff44","#44ffff","#ff44ff"],a=new Map,r=window.parent===window;(async function(e){const n=await new Promise((e=>{chrome.storage.sync.get(["allowedUrls"],(({allowedUrls:n})=>{e(n)}))}));return 0==n.length||n.some((n=>0==n.trim().length||e.indexOf(n.trim())>=0))})(document.location.href).then((i=>{i&&r&&(document.addEventListener("keydown",(e=>{e.ctrlKey&&","==e.key&&(o(),n.focus())})),document.addEventListener("onunload",(e=>{chrome.runtime.sendMessage({command:"documentUnloaded",url:document.location.href})})),chrome.runtime.onMessage.addListener(((e,n,s)=>{console.log("onMessage",e),"onNewMessage"===e.command&&function({nick:e,msgContents:n}){console.log("Drawing:",e,n);const s=document.createElement("li");s.style.color=function(e){if(a.has(e))return a.get(e);const n=c[a.size];return a.set(e,n),n}(e),s.innerText=`${e}: ${n}`,t.appendChild(s),o(),setTimeout((()=>{s.remove(),setTimeout(d,15e3)}),6e4)}(e.data),s({})})),t&&(t.innerHTML=""),setTimeout((()=>{e=document.createElement("div"),e.id="HuddleHUD",e.style.display="none",t=document.createElement("ul"),e.appendChild(t),n=document.createElement("input"),n.placeholder='Press "ðšŒðšðš›ðš•-," to focus input box',n.addEventListener("blur",(e=>{setTimeout(d,15e3)})),n.addEventListener("keydown",(e=>{switch(e.stopPropagation(),e.key){case"Esc":case"Escape":s();break;case"Enter":{const e=n.value.trim();e.length&&chrome.runtime.sendMessage({command:"userMessage",msgContents:e,url:document.location.href}),n.value=""}}})),e.appendChild(n),document.body.appendChild(e),chrome.runtime.sendMessage({command:"contentScriptLoaded",url:document.location.href})}),1e3))}))})();