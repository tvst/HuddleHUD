(()=>{let e,n,t=document.querySelector("#HuddleHud > ul");function o(){e.style.display=""}function d(){e.style.display="none"}function s(){0==t.children.length&&d()}const c=["#ff4444","#44ff44","#4444ff","#ffff44","#44ffff","#ff44ff"],r=new Map,a=window.parent===window;(async function(e){const n=await new Promise((e=>{chrome.storage.sync.get(["allowedUrls"],(({allowedUrls:n})=>{e(n)}))}));return 0==n.length||n.some((n=>0==n.trim().length||e.indexOf(n.trim())>=0))})(document.location.href).then((l=>{l&&a&&(e=document.createElement("div"),e.id="HuddleHUD",e.style.display="none",t=document.createElement("ul"),e.appendChild(t),n=document.createElement("input"),n.placeholder='Press "ðšŒðšðš›ðš•-," to focus input box',n.addEventListener("blur",(e=>{window.setTimeout(s,15e3)})),n.addEventListener("keydown",(e=>{switch(e.key){case"Esc":case"Escape":d();break;case"Enter":{const e=n.value.trim();e.length&&chrome.runtime.sendMessage({command:"userMessage",msgContents:e,url:document.location.href}),n.value=""}}})),e.appendChild(n),document.body.appendChild(e),document.addEventListener("keydown",(e=>{e.ctrlKey&&","==e.key&&(o(),n.focus())})),document.addEventListener("onunload",(e=>{chrome.runtime.sendMessage({command:"documentUnloaded",url:document.location.href})})),chrome.runtime.onMessage.addListener(((e,n,d)=>{console.log("onMessage",e),"onNewMessage"===e.command&&function({nick:e,msgContents:n}){console.log("Drawing:",e,n);const d=document.createElement("li");d.style.color=function(e){if(r.has(e))return r.get(e);const n=c[r.size];return r.set(e,n),n}(e),d.innerText=`${e}: ${n}`,t.appendChild(d),o(),setTimeout((()=>{d.remove(),setTimeout(s,15e3)}),6e4)}(e.data),d({})})),t&&(t.innerHTML=""),chrome.runtime.sendMessage({command:"contentScriptLoaded",url:document.location.href}))}))})();