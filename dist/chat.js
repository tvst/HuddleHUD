(()=>{let e,n,t;function o(){e.style.display=""}function s(){e.style.display="none"}function c(){0==n.children.length&&s()}const d=["#ff4444","#44ff44","#4444ff","#ffff44","#44ffff","#ff44ff"],a=new Map,r=window.parent===window;(async function(e){const n=await async function(){const{allowedUrls:e}=await chrome.storage.sync.get(["allowedUrls"]);return e}();return 0==n.length||n.some((n=>0==n.trim().length||e.indexOf(n.trim())>=0))})(document.location.href).then((i=>{i&&r&&(e=document.createElement("div"),e.id="HuddleHUD",e.style.display="none",n=document.createElement("ul"),e.appendChild(n),t=document.createElement("input"),t.placeholder='Press "𝚌𝚝𝚛𝚕-," to focus input box',t.addEventListener("blur",(e=>{window.setTimeout(c,15e3)})),t.addEventListener("keydown",(e=>{switch(e.key){case"Esc":case"Escape":s();break;case"Enter":{const e=t.value.trim();e.length&&chrome.runtime.sendMessage({command:"userMessage",msgContents:e,url:document.location.href}),t.value=""}}})),e.appendChild(t),document.body.appendChild(e),document.addEventListener("keydown",(e=>{e.ctrlKey&&","==e.key&&(o(),t.focus())})),document.addEventListener("onunload",(e=>{chrome.runtime.sendMessage({command:"documentUnloaded",url:document.location.href})})),chrome.runtime.onMessage.addListener(((e,t,s)=>{switch(console.log("onMessage",e),e.command){case"onSubscribed":n&&(n.innerHTML="");break;case"onNewMessage":!function({nick:e,msgContents:t}){console.log("Drawing:",e,t);const s=document.createElement("li");s.style.color=function(e){if(a.has(e))return a.get(e);const n=d[a.size];return a.set(e,n),n}(e),s.innerText=`${e}: ${t}`,n.appendChild(s),o(),setTimeout((()=>{s.remove(),setTimeout(c,15e3)}),6e4)}(e.data)}return!0})),chrome.runtime.sendMessage({command:"contentScriptLoaded",url:document.location.href}))}))})();